<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Clientes y Servicios</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    form { margin-bottom: 15px; }
    input { margin: 5px; padding: 5px; }
    button { margin: 2px; padding: 5px 10px; }
    ul { list-style-type: none; padding: 0; }
    li { margin-bottom: 5px; }
    .acciones button { margin-left: 5px; }
  </style>
</head>
<body>
  <h1>Clientes</h1>

  <form id="formCliente">
    <input type="text" id="nombreCliente" placeholder="Nombre Cliente" required>
    <input type="email" id="correoCliente" placeholder="Correo Cliente" required>
    <button type="submit">Agregar Cliente</button>
  </form>

  <button onclick="cargarClientes()">Ver Clientes</button>
  <ul id="listaClientes"></ul>

  <h1>Servicios</h1>

  <form id="formServicio">
    <input type="text" id="nombreServicio" placeholder="Nombre Servicio" required>
    <input type="text" id="descripcionServicio" placeholder="Descripción">
    <button type="submit">Agregar Servicio</button>
  </form>

  <button onclick="cargarServicios()">Ver Servicios</button>
  <ul id="listaServicios"></ul>

  <script>
    const API_URL = "http://localhost:5074/api";

    // ---------- CLIENTES ----------
    document.getElementById("formCliente").addEventListener("submit", async e => {
      e.preventDefault();
      const nombreCliente = document.getElementById("nombreCliente").value;
      const correo = document.getElementById("correoCliente").value;

      await fetch(`${API_URL}/clientes`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombreCliente, correo })
      });

      e.target.reset();
      cargarClientes();
    });

    async function cargarClientes() {
      const res = await fetch(`${API_URL}/clientes`);
      const data = await res.json();

      const lista = document.getElementById("listaClientes");
      lista.innerHTML = "";
      data.forEach(c => {
        const li = document.createElement("li");
        li.textContent = `${c.id} - ${c.nombreCliente} (${c.correo})`;

        const acciones = document.createElement("span");
        acciones.classList.add("acciones");

        // Editar
        const btnEditar = document.createElement("button");
        btnEditar.textContent = "✏️";
        btnEditar.onclick = async () => {
          const nuevoNombre = prompt("Nuevo nombre:", c.nombreCliente);
          const nuevoCorreo = prompt("Nuevo correo:", c.correo);
          if (nuevoNombre && nuevoCorreo) {
            await fetch(`${API_URL}/clientes/${c.id}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ id: c.id, nombreCliente: nuevoNombre, correo: nuevoCorreo })
            });
            cargarClientes();
          }
        };

        // Eliminar
        const btnEliminar = document.createElement("button");
        btnEliminar.textContent = "🗑️";
        btnEliminar.onclick = async () => {
          if (confirm(`¿Eliminar cliente ${c.nombreCliente}?`)) {
            await fetch(`${API_URL}/clientes/${c.id}`, { method: "DELETE" });
            cargarClientes();
          }
        };

        acciones.appendChild(btnEditar);
        acciones.appendChild(btnEliminar);
        li.appendChild(acciones);
        lista.appendChild(li);
      });
    }

    // ---------- SERVICIOS ----------
    document.getElementById("formServicio").addEventListener("submit", async e => {
      e.preventDefault();
      const nombreServicio = document.getElementById("nombreServicio").value;
      const descripcion = document.getElementById("descripcionServicio").value;

      await fetch(`${API_URL}/servicios`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombreServicio, descripcion })
      });

      e.target.reset();
      cargarServicios();
    });

    async function cargarServicios() {
      const res = await fetch(`${API_URL}/servicios`);
      const data = await res.json();

      const lista = document.getElementById("listaServicios");
      lista.innerHTML = "";
      data.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `${s.id} - ${s.nombreServicio}: ${s.descripcion ?? ""}`;

        const acciones = document.createElement("span");
        acciones.classList.add("acciones");

        // Editar
        const btnEditar = document.createElement("button");
        btnEditar.textContent = "✏️";
        btnEditar.onclick = async () => {
          const nuevoNombre = prompt("Nuevo nombre:", s.nombreServicio);
          const nuevaDesc = prompt("Nueva descripción:", s.descripcion ?? "");
          if (nuevoNombre) {
            await fetch(`${API_URL}/servicios/${s.id}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ id: s.id, nombreServicio: nuevoNombre, descripcion: nuevaDesc })
            });
            cargarServicios();
          }
        };

        // Eliminar
        const btnEliminar = document.createElement("button");
        btnEliminar.textContent = "🗑️";
        btnEliminar.onclick = async () => {
          if (confirm(`¿Eliminar servicio ${s.nombreServicio}?`)) {
            await fetch(`${API_URL}/servicios/${s.id}`, { method: "DELETE" });
            cargarServicios();
          }
        };

        acciones.appendChild(btnEditar);
        acciones.appendChild(btnEliminar);
        li.appendChild(acciones);
        lista.appendChild(li);
      });
    }
  </script>
</body>
</html>
